#!/bin/bash

#
# Sistem Manajemen Zakat - MPZ Alumni FK Unand Padang
# Copyright (c) 2025 Pramudito Metra
# 
# PRE-COMMIT HOOK - Copyright Protection
#

echo "üîç Checking copyright integrity..."

# Check if copyright files exist
required_files=("LICENSE" "SECURITY.md" "README.md" "check-integrity.php")

for file in "${required_files[@]}"; do
    if [ ! -f "$file" ]; then
        echo "‚ùå ERROR: Required file '$file' is missing!"
        echo "This file contains important copyright information."
        exit 1
    fi
done

# Check if copyright notices are intact
if ! grep -q "Pramudito Metra" LICENSE; then
    echo "‚ùå ERROR: Copyright notice removed from LICENSE!"
    exit 1
fi

if ! grep -q "pramuditometra@gmail.com" README.md; then
    echo "‚ùå ERROR: Author information removed from README.md!"
    exit 1
fi

# Check git remote origin
origin_url=$(git remote get-url origin 2>/dev/null || echo "")
if [[ ! "$origin_url" == *"pramuditometra"* ]]; then
    echo "‚ö†Ô∏è  WARNING: Git origin has been changed from original repository!"
    echo "Original: https://github.com/pramuditometra/zakat-mpz"
    echo "Current: $origin_url"
    echo ""
    echo "If this is intentional, make sure to:"
    echo "1. Keep all copyright notices intact"
    echo "2. Provide proper attribution"
    echo "3. Include link to original repository"
    echo ""
    read -p "Continue anyway? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "‚úÖ Copyright integrity check passed!"
exit 0
